{% extends 'base.html' %}
{% block content %}
<h2>Create New Report</h2>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group">
        <label>Title:</label>
        <input type="text" name="title" required>
    </div>
    <div class="form-group">
        <label>Description:</label>
        <textarea name="description" rows="4" required></textarea>
    </div>
    <div class="form-group">
        <label>Image:</label>
        <input type="file" name="image" accept="image/*" required>
    </div>
    <div class="form-group">
        <label>Location:</label>
        <button type="button" class="btn" onclick="getLocation()" style="margin-bottom: 10px;">Get My Location</button>
        <p id="location-status" style="color: #666; margin: 5px 0;">Click button to detect your location</p>
    </div>
    <div class="form-group">
        <label>Latitude:</label>
        <input type="number" step="0.000001" name="latitude" id="latitude" value="10.0" required>
    </div>
    <div class="form-group">
        <label>Longitude:</label>
        <input type="number" step="0.000001" name="longitude" id="longitude" value="76.0" required>
    </div>
    <button type="submit" class="btn w-64 rounded-full">Submit</button>
</form>

<script>
    function getLocation() {
        const statusEl = document.getElementById('location-status');

        if (!navigator.geolocation) {
            statusEl.textContent = 'Error fetching your location!';
            statusEl.style.color = '#dc3545';
            return;
        }

        statusEl.textContent = 'Getting your location...';
        statusEl.style.color = '#007bff';

        navigator.geolocation.getCurrentPosition(
            function (position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                const accuracy = position.coords.accuracy;

                document.getElementById('latitude').value = lat.toFixed(6);
                document.getElementById('longitude').value = lon.toFixed(6);

                statusEl.textContent = 'âœ… Location detected! (Accuracy: ' + Math.round(accuracy) + 'm)';
                statusEl.style.color = '#28a745';
            },
            function (error) {
                let errorMsg = '';
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        errorMsg = 'Please enable location access in your browser settings!';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMsg = 'Please enable location services on your device!';
                        break;
                    case error.TIMEOUT:
                        errorMsg = 'Please try again!';
                        break;
                    default:
                        errorMsg = 'Unknown error occurred: ' + error.message;
                }
                statusEl.textContent = errorMsg;
                statusEl.style.color = '#dc3545';
                console.error('Geolocation error:', error);
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            }
        );
    }

    window.addEventListener('load', function () {
        getLocation();
    });
</script>
{% endblock %}